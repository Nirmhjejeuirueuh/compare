---
/**
 * InvestmentItem Component
 * Displays detailed investment brokerage information with fees, rewards, and promotions
 */

import OptimizedImage from "@/components/utilities/OptimizedImage.astro";

interface Reward {
  icon?: string;
  image?: string;
  title: string;
  value: string;
  points?: string;
}

interface Promotion {
  type: string;
  title: string;
  description: string;
  details?: string[];
  validUntil?: string;
}

interface Props {
  providerLogo: string;
  providerName: string;
  badges?: string[];
  fees: Array<{
    amount: string;
    description: string;
    note?: string;
  }>;
  rewards?: Reward[];
  promotions?: Promotion[];
  applyUrl?: string;
  featured?: boolean;
  promotionTypes?: string[];
  signUpFeatures?: string[];
  provider?: string;
  category?: string;
}

const {
  providerLogo,
  providerName,
  badges = [],
  fees,
  rewards = [],
  promotions = [],
  applyUrl = "#",
  featured = false,
} = Astro.props;
---

<div class="investment-item rounded-xl border-2 border-gray-200 bg-white p-6 shadow-sm transition-shadow duration-300 hover:shadow-lg">
  <!-- Badges -->
  {
    badges.length > 0 && (
      <div class="mb-4 flex flex-wrap gap-2">
        {badges.map((badge) => {
          const isExclusive = badge.toLowerCase().includes('exclusive');
          const badgeClass = isExclusive
            ? "bg-yellow-400 text-gray-900"
            : "bg-slate-800 text-white";
          return (
            <span class={`inline-block rounded px-3 py-1 text-xs font-bold uppercase ${badgeClass}`}>
              {badge}
            </span>
          );
        })}
      </div>
    )
  }

  <!-- Investment Main Info -->
  <div class="mb-6 flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
    <!-- Provider Logo and Name -->
    <div class="flex items-center gap-4 lg:w-48">
      <div class="flex h-20 w-20 flex-shrink-0 items-center justify-center overflow-hidden rounded-lg bg-white border-2 border-gray-100 p-2">
        <OptimizedImage
          src={providerLogo}
          alt={providerName}
          width={80}
          height={80}
          class="h-full w-full object-contain"
        />
      </div>
      <div>
        <h3 class="text-lg font-bold text-gray-900">{providerName}</h3>
      </div>
    </div>

    <!-- Fee Details -->
    <div class="flex flex-wrap gap-4 lg:flex-1 lg:justify-center">
      {
        fees.map((fee) => (
          <div class="fee-detail flex-1 min-w-[180px]">
            <p class="mb-1 text-2xl font-bold text-gray-900">{fee.amount}</p>
            <p class="text-xs text-gray-600">
              {fee.description}
              {fee.note && <sup class="ml-0.5">{fee.note}</sup>}
            </p>
          </div>
        ))
      }
    </div>

    <!-- Apply Button -->
    <div class="flex flex-col items-start gap-2 lg:items-end lg:w-40">
      <a
        href={applyUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="btn-apply whitespace-nowrap"
      >
        APPLY NOW
      </a>
    </div>
  </div>

  <!-- Rewards Section -->
  {
    rewards.length > 0 && (
      <div class="mb-6">
        <p class="mb-4 font-semibold text-gray-900">Apply and redeem any of these rewards</p>
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {rewards.map((reward) => (
            <div class="reward-card rounded-lg border-2 border-gray-200 bg-white p-4 text-center">
              {reward.icon && (
                <div class="mb-3 flex items-center justify-center">
                  <div data-lucide={reward.icon} class="h-12 w-12 text-green-600" />
                </div>
              )}
              {reward.image && (
                <div class="mb-3 flex items-center justify-center">
                  <OptimizedImage
                    src={reward.image}
                    alt={reward.title}
                    width={80}
                    height={80}
                    class="h-20 w-20 object-contain"
                  />
                </div>
              )}
              <h4 class="mb-1 text-sm font-bold text-gray-900">{reward.title}</h4>
              <p class="mb-1 text-xs text-gray-600">{reward.value}</p>
              {reward.points && (
                <p class="text-xs text-gray-500">{reward.points}</p>
              )}
            </div>
          ))}
        </div>
      </div>
    )
  }

  <!-- Promotions Section -->
  {
    promotions.map((promo) => {
      const bgClass = promo.type === 'exclusive'
        ? 'bg-green-50 border-green-200'
        : 'bg-cyan-50 border-cyan-200';

      return (
        <div class={`mt-4 rounded-lg border-2 p-4 ${bgClass}`}>
          <h4 class="mb-2 font-bold text-gray-900">[{promo.title}]</h4>
          <p class="mb-3 text-sm text-gray-700" set:html={promo.description} />

          {promo.details && promo.details.length > 0 && (
            <ul class="mb-3 space-y-1 text-sm text-gray-700">
              {promo.details.map((detail) => (
                <li class="flex items-start gap-2">
                  <span class="text-green-600">â€¢</span>
                  <span set:html={detail} />
                </li>
              ))}
            </ul>
          )}

          {promo.validUntil && (
            <p class="text-xs font-semibold text-gray-600">{promo.validUntil}</p>
          )}
        </div>
      );
    })
  }

  <!-- Expandable Details Section -->
  <div class="mt-4 space-y-2">
    <details class="group">
      <summary class="flex cursor-pointer items-center justify-between rounded-lg bg-gray-50 px-4 py-3 font-semibold text-gray-900 transition-colors hover:bg-gray-100">
        <span class="flex items-center gap-2">
          <div data-lucide="info" class="h-5 w-5"></div>
          Investment Details
        </span>
        <div data-lucide="chevron-down" class="h-5 w-5 transition-transform group-open:rotate-180"></div>
      </summary>
      <div class="mt-2 rounded-lg border-2 border-gray-100 bg-white p-4">
        <p class="text-sm text-gray-700">
          Detailed investment information including features, minimum funding, and available assets will be displayed here.
        </p>
      </div>
    </details>

    <details class="group">
      <summary class="flex cursor-pointer items-center justify-between rounded-lg bg-gray-50 px-4 py-3 font-semibold text-gray-900 transition-colors hover:bg-gray-100">
        <span class="flex items-center gap-2">
          <div data-lucide="file-text" class="h-5 w-5"></div>
          Sign Up Requirements
        </span>
        <div data-lucide="chevron-down" class="h-5 w-5 transition-transform group-open:rotate-180"></div>
      </summary>
      <div class="mt-2 rounded-lg border-2 border-gray-100 bg-white p-4">
        <p class="text-sm text-gray-700">
          Sign up requirements and account opening process will be displayed here.
        </p>
      </div>
    </details>
  </div>
</div>
