---
/**
 * PersonalLoanItem Component
 * Displays detailed personal loan information with rates, fees, and apply button
 */

import OptimizedImage from "@/components/utilities/OptimizedImage.astro";

interface Promotion {
  title: string;
  description: string;
  validUntil?: string;
  rewardAmount?: string;
  terms?: string;
}

interface Props {
  lenderLogo: string;
  lenderName: string;
  loanName: string;
  badges?: string[];
  interestRate: string;
  interestRateNote?: string;
  eir?: string;
  totalAmount: string;
  processingFee: string;
  perMonth: string;
  promotion?: Promotion;
  applyUrl?: string;
  featured?: boolean;
  features?: string[];
  bank?: string;
}

const {
  lenderLogo,
  lenderName,
  loanName,
  badges = [],
  interestRate,
  interestRateNote,
  eir,
  totalAmount,
  processingFee,
  perMonth,
  promotion,
  applyUrl = "#",
  featured = false,
} = Astro.props;
---

<div class="personal-loan-item rounded-xl border-2 border-gray-200 bg-white p-6 shadow-sm transition-shadow duration-300 hover:shadow-lg">
  <!-- Badges -->
  {
    badges.length > 0 && (
      <div class="mb-4 flex flex-wrap gap-2">
        {badges.map((badge) => {
          const isExclusive = badge.toLowerCase().includes('exclusive');
          const badgeClass = isExclusive
            ? "bg-yellow-400 text-gray-900"
            : "bg-slate-800 text-white";
          return (
            <span class={`inline-block rounded px-3 py-1 text-xs font-bold uppercase ${badgeClass}`}>
              {badge}
            </span>
          );
        })}
      </div>
    )
  }

  <!-- Loan Main Info -->
  <div class="mb-6 flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
    <!-- Lender Logo and Name -->
    <div class="flex items-center gap-4 lg:w-48">
      <div class="flex h-20 w-20 flex-shrink-0 items-center justify-center overflow-hidden rounded-lg bg-white border-2 border-gray-100 p-2">
        <OptimizedImage
          src={lenderLogo}
          alt={lenderName}
          width={80}
          height={80}
          class="h-full w-full object-contain"
        />
      </div>
      <div>
        <h3 class="text-lg font-bold text-gray-900">{loanName}</h3>
      </div>
    </div>

    <!-- Loan Details -->
    <div class="flex flex-wrap gap-4 lg:flex-1 lg:justify-center">
      <!-- Interest Rate -->
      <div class="loan-detail flex-1 min-w-[140px]">
        <p class="mb-1 text-2xl font-bold text-gray-900">{interestRate}</p>
        <p class="text-xs text-gray-600">
          Interest Rates
          {interestRateNote && <sup class="ml-0.5">1</sup>}
        </p>
        {eir && (
          <p class="mt-1 text-xs text-gray-500">EIR: {eir}</p>
        )}
      </div>

      <!-- Total Amount -->
      <div class="loan-detail flex-1 min-w-[140px]">
        <p class="mb-1 text-2xl font-bold text-gray-900">
          <span class="text-base">S$</span>{totalAmount}
        </p>
        <p class="text-xs text-gray-600">Total Amount Payable</p>
      </div>

      <!-- Processing Fee -->
      <div class="loan-detail flex-1 min-w-[140px]">
        <p class="mb-1 text-2xl font-bold text-gray-900">
          <span class="text-base">S$</span>{processingFee}
        </p>
        <p class="text-xs text-gray-600">
          Processing Fee
          <sup class="ml-0.5">2</sup>
        </p>
      </div>

      <!-- Per Month -->
      <div class="loan-detail flex-1 min-w-[140px]">
        <p class="mb-1 text-2xl font-bold text-gray-900">
          <span class="text-base">S$</span>{perMonth}
        </p>
        <p class="text-xs text-gray-600">
          Per Month
          <sup class="ml-0.5">2</sup>
        </p>
      </div>
    </div>

    <!-- Apply Button -->
    <div class="flex flex-col items-start gap-2 lg:items-end lg:w-40">
      <a
        href={applyUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="btn-apply whitespace-nowrap"
      >
        APPLY NOW
      </a>
    </div>
  </div>

  <!-- Promotion Section -->
  {
    promotion && (
      <div class="mt-6 rounded-lg bg-cyan-50 border-2 border-cyan-100 p-4">
        <div class="flex items-start justify-between gap-4">
          <div class="flex-1">
            <h4 class="mb-2 font-bold text-gray-900">[{promotion.title}]</h4>
            <p class="mb-3 text-sm text-gray-700" set:html={promotion.description} />
            {promotion.terms && (
              <p class="text-xs text-cyan-700">
                {promotion.terms}
              </p>
            )}
            {promotion.validUntil && (
              <p class="mt-2 text-xs font-semibold text-gray-600">
                {promotion.validUntil}
              </p>
            )}
          </div>
          {promotion.rewardAmount && (
            <div class="flex-shrink-0">
              <div class="flex h-20 w-20 flex-col items-center justify-center rounded-full bg-gradient-to-br from-yellow-400 to-yellow-500 text-center">
                <p class="text-xs font-semibold uppercase text-gray-900">UP TO</p>
                <p class="text-lg font-bold text-gray-900">${promotion.rewardAmount}</p>
                <p class="text-xs font-semibold uppercase text-gray-900">CASH</p>
              </div>
            </div>
          )}
        </div>
      </div>
    )
  }

  <!-- Expandable Details Section -->
  <div class="mt-4 space-y-2">
    <details class="group">
      <summary class="flex cursor-pointer items-center justify-between rounded-lg bg-gray-50 px-4 py-3 font-semibold text-gray-900 transition-colors hover:bg-gray-100">
        <span class="flex items-center gap-2">
          <div data-lucide="info" class="h-5 w-5"></div>
          Loan Details
        </span>
        <div data-lucide="chevron-down" class="h-5 w-5 transition-transform group-open:rotate-180"></div>
      </summary>
      <div class="mt-2 rounded-lg border-2 border-gray-100 bg-white p-4">
        <p class="text-sm text-gray-700">
          Detailed loan information including terms, conditions, and requirements will be displayed here.
        </p>
      </div>
    </details>

    <details class="group">
      <summary class="flex cursor-pointer items-center justify-between rounded-lg bg-gray-50 px-4 py-3 font-semibold text-gray-900 transition-colors hover:bg-gray-100">
        <span class="flex items-center gap-2">
          <div data-lucide="file-text" class="h-5 w-5"></div>
          Eligibility & Requirements
        </span>
        <div data-lucide="chevron-down" class="h-5 w-5 transition-transform group-open:rotate-180"></div>
      </summary>
      <div class="mt-2 rounded-lg border-2 border-gray-100 bg-white p-4">
        <p class="text-sm text-gray-700">
          Eligibility criteria and required documents will be displayed here.
        </p>
      </div>
    </details>
  </div>
</div>
