---
import type { Section } from "@/types";
import type { z } from "astro:schema";
import { getEntryCTM } from "@/lib/contentParser.astro";
import { markdownify } from "@/lib/utils/textConverter";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import type { benefitsSectionSchema } from "@/sections.schema";
import Icons from "@/helpers/Icons.astro";
import type { icons } from "@lucide/astro";
import AnimatedText from "../widgets/AnimatedText.astro";

// Type
type benefitsSectionType = Section & z.infer<typeof benefitsSectionSchema>;
type Props = {
  content?: benefitsSectionType;
};

// Default content fetch
let defaultContent = (
  await getEntryCTM("sections", "why-us", Astro.currentLocale)
)?.data as benefitsSectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as benefitsSectionType;

let { enable = true, title, benefits } = actualContent as benefitsSectionType;

if (!enable) return;
---

<section>
  <div class="container space-y-10 md:space-y-16">
    {
      title && (
        <div class="mx-auto max-w-2xl text-center">
          <h2 class="has-italic-text capitalize">
            <AnimatedText
              delay={0.2}
              stagger={0.09}
              content={markdownify(title)}
            />
          </h2>
        </div>
      )
    }

    {
      benefits && (
        <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {benefits.map((item, index) => (
            <div
              data-aos="fade-up-sm"
              data-aos-delay={(index + 1) * 50}
              data-aos-duration={900}
              class="flex flex-col gap-4 border p-5 md:p-8">
              <Icons class="text-3xl" icon={item.icon as keyof typeof icons} />
              <div class="mt-4 space-y-3">
                {item.title && (
                  <h3
                    class="text-h5-sm md:text-h5"
                    set:html={markdownify(item.title)}
                  />
                )}
                {item.description && (
                  <p
                    class="opacity-80"
                    set:html={markdownify(item.description)}
                  />
                )}
              </div>
            </div>
          ))}
        </div>
      )
    }
  </div>
</section>
