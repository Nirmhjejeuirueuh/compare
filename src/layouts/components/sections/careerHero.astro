---
import type { Section } from "@/types";
import type { z } from "astro:schema";
import { getEntryCTM } from "@/lib/contentParser.astro";
import { markdownify } from "@/lib/utils/textConverter";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import type { aboutSectionSchema } from "@/sections.schema";
import OptimizedImage from "../utilities/OptimizedImage.astro";
import AnimatedText from "../widgets/AnimatedText.astro";
import AnimatedNumber from "../widgets/AnimatedNumber.astro";

// Type
type SectionType = Section & z.infer<typeof aboutSectionSchema>;
type Props = {
  content?: SectionType;
};

// Default content fetch
let defaultContent = (
  await getEntryCTM("sections", "career-hero", Astro.currentLocale)
)?.data as SectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as SectionType;

let {
  enable = true,
  title,
  description,
  officeImages,
  stats,
} = actualContent as SectionType;

if (!enable) return;
---

<section class="overflow-hidden">
  <div class="space-y-16 md:space-y-32">
    <div
      class="container mx-auto flex flex-wrap justify-between gap-10 lg:max-w-5xl">
      {
        title && (
          <h2 class="has-italic-text text-h1 capitalize">
            <AnimatedText
              delay={0.2}
              stagger={0.09}
              content={markdownify(title)}
            />
          </h2>
        )
      }
      {
        description && (
          <p
            class="max-w-sm text-lg"
            set:html={markdownify(description)}
            data-aos="fade-up-sm"
            data-aos-delay="200"
          />
        )
      }
    </div>
    {
      officeImages && (
        <div class="flex justify-center gap-4 px-4 max-md:h-80 max-md:overflow-hidden md:gap-8">
          {officeImages.map((item, index) => {
            const middle = Math.floor(officeImages.length / 2);
            const step = 10; // increase step
            const baseHeight = 80; // starting height

            // Calculate distance from the middle
            const distance = Math.abs(index - middle);

            // Max distance from the middle
            const maxDistance = middle;

            // Height = baseHeight + (maxDistance - distance) * step
            const height = baseHeight + (maxDistance - distance) * step;

            return (
              <div
                data-aos="fade-up-sm"
                data-aos-delay={(index + 4) * 50}
                class:list={[
                  "w-full flex-col items-center justify-center",
                  index % 3 === 0 ? "hidden md:block lg:flex" : "flex",
                ]}>
                <OptimizedImage
                  src={item}
                  class="block w-full rounded-lg object-cover"
                  style={{ height: `${height}%` }}
                  alt="Office Image"
                />
              </div>
            );
          })}
        </div>
      )
    }
    {
      stats && (
        <div class="container grid grid-cols-1 gap-12 sm:grid-cols-2 lg:grid-cols-4">
          {stats.map((item) => (
            <div class="space-y-3.5 md:text-center">
              {item.value && (
                <AnimatedNumber
                  class="text-h2-sm md:text-h2 block"
                  content={item}
                />
              )}
              {item.title && (
                <h3
                  class="text-h6-sm md:text-h6"
                  set:html={markdownify(item.title)}
                />
              )}
              {item.description && (
                <p set:html={markdownify(item.description)} />
              )}
            </div>
          ))}
        </div>
      )
    }
  </div>
</section>
